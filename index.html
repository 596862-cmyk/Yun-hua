<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNIé›²è²´åˆ†æœƒ - æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        html { transition: font-size 0.2s ease-in-out; }
        body { font-family: 'Noto Sans TC', sans-serif; overflow-x: hidden; }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .completed { background: linear-gradient(135deg, #10b981, #059669); }
        .in-progress { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .not-started { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dashoffset 0.35s; }
        .category-filter { transition: all 0.3s ease; }
        .category-filter.active { background: linear-gradient(135deg, #8b5cf6, #7c3aed); transform: scale(1.05); }
        * { box-sizing: border-box; }
        .modal-overlay { backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 min-h-screen">
    <div id="fontSizeController" class="fixed bottom-4 right-4 z-50 flex items-center space-x-2 bg-white/10 backdrop-blur-lg p-2 rounded-full border border-white/20">
        <button id="decreaseFont" class="w-10 h-10 flex items-center justify-center bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-lg font-bold">A-</button>
        <button id="resetFont" class="w-10 h-10 flex items-center justify-center bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-sm font-bold">A</button>
        <button id="increaseFont" class="w-10 h-10 flex items-center justify-center bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-xl font-bold">A+</button>
    </div>

    <div id="loginScreen" class="min-h-screen px-4 py-8">
        <div class="container mx-auto max-w-6xl">
            <div class="flex justify-center mb-8">
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-white/20">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-white mb-2">ğŸ¢ BNIé›²è²´åˆ†æœƒ</h1>
                        <h2 class="text-2xl font-semibold text-blue-200 mb-4">æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</h2>
                        <p class="text-lg text-blue-300">è«‹è¼¸å…¥æ‚¨çš„å°ç”Ÿè³‡è¨Š</p>
                        <p class="text-sm text-yellow-300 mt-2">âš ï¸ å°ç”Ÿå¸³è™Ÿç”±å°å¸«å»ºç«‹ï¼Œç„¡æ³•è‡ªè¡Œè¨»å†Š</p>
                    </div>
                    <div id="loginFormContainer">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-white text-base font-medium mb-2">å°ç”Ÿå§“å</label>
                                <input type="text" id="memberName" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                            </div>
                            <div>
                                <label class="block text-white text-base font-medium mb-2">å°ç”Ÿå¯†ç¢¼</label>
                                <input type="password" id="memberPassword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="è«‹è¼¸å…¥å°å¸«ç‚ºæ‚¨è¨­å®šçš„å¯†ç¢¼">
                            </div>
                            <button type="button" id="loginButton" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all text-lg">
                                é–‹å§‹æˆ‘çš„æ–°æ‰‹æ‘ä¹‹æ—…
                            </button>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button type="button" id="showAdminBtn" class="text-blue-300 hover:text-blue-200 text-sm underline">
                            å°å¸«ç™»å…¥
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center mb-8">
                 <button type="button" id="toggleGuestSectionBtn" class="w-full max-w-md bg-teal-600/50 hover:bg-teal-500/50 text-white py-3 rounded-lg font-semibold transition-all text-lg">
                    ğŸ“ BNI ä¾†è³“ç™»è¨˜
                </button>
            </div>

            <div id="guestFormSection" class="hidden">
                <div class="flex justify-center mb-8">
                    <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-white/20">
                        <h3 class="text-2xl font-semibold text-white mb-6 text-center">ä¾†è³“ç™»è¨˜è¡¨</h3>
                        <div class="space-y-4" id="guestForm">
                             <input type="text" id="guestName" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ä¾†è³“å§“å">
                             <input type="text" id="guestProfession" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ä¾†è³“å°ˆæ¥­åˆ¥">
                             <input type="text" id="guestReferrer" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ä»‹ç´¹äºº">
                             <select id="guestInterest" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-400">
                                 <option value="é«˜">åŠ å…¥æ„é¡˜åº¦ï¼šé«˜</option>
                                 <option value="ä¸­">åŠ å…¥æ„é¡˜åº¦ï¼šä¸­</option>
                                 <option value="ä½">åŠ å…¥æ„é¡˜åº¦ï¼šä½</option>
                             </select>
                             <button type="button" id="submitGuestBtn" class="w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white py-3 rounded-lg font-semibold hover:from-teal-600 hover:to-cyan-600 transition-all">
                                 æäº¤ç™»è¨˜
                             </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="calendarSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 mb-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">ğŸ“… åˆ†æœƒè¡Œäº‹æ›†</h2>
                </div>
                <div id="publicCalendarList" class="space-y-3">
                </div>
            </div>

            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <div id="togglePublicGuestList" class="flex items-center justify-center space-x-2 text-center mb-6 cursor-pointer">
                    <h2 class="text-2xl font-bold text-white">ğŸ‘‹ æœ€æ–°ä¾†è³“</h2>
                    <svg id="guestListChevron" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white transition-transform transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
                <div id="publicGuestListContainer" class="space-y-3 transition-all duration-300">
                    </div>
            </div>

            <div id="graduatedMembersSection" class="mt-8 mb-8 hidden">
                <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 backdrop-blur-lg rounded-2xl p-6 border border-yellow-400/30">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-yellow-300 mb-2">ğŸ† å·²å‡ºæ‘å°ç”Ÿè¡¨æš ğŸ†</h2>
                        <p class="text-yellow-200">æ­å–œä»¥ä¸‹å°ç”Ÿå®Œæˆæ‰€æœ‰å¿…ä¿®ä»»å‹™ï¼Œæˆç‚ºBNIå°ˆæ¥­å°ç”Ÿï¼</p>
                    </div>
                    <div id="graduatedMembersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            </div>
            <div id="loginRankingSection" class="mt-8 hidden">
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">ğŸ“Š å°ç”Ÿæ’è¡Œæ¦œ</h2>
                        <p class="text-blue-300">æ–°æ‰‹æ‘ä»»å‹™å®Œæˆé€²åº¦æ’å</p>
                    </div>
                    <div id="loginRankingList" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="mainContent" class="container mx-auto px-4 py-8 hidden">
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-4 mb-6 border border-white/20">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg" id="memberAvatar"></div>
                    <div>
                        <h3 class="text-lg font-semibold text-white" id="displayMemberName">å°ç”Ÿå§“å</h3>
                        <p class="text-blue-200 text-sm">BNIé›²è²´åˆ†æœƒå°ç”Ÿ</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button type="button" id="logoutBtn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">ç™»å‡º</button>
                </div>
            </div>
        </div>
        <div class="text-center mb-8">
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-2">ğŸ¢ BNIé›²è²´åˆ†æœƒ</h1>
            <h2 class="text-3xl md:text-4xl font-semibold text-blue-200 mb-4">æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</h2>
            <p class="text-xl text-blue-300">å®Œæˆæ‰€æœ‰é—œå¡ï¼Œæˆç‚ºBNIå°ˆæ¥­å°ç”Ÿï¼</p>
        </div>
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-8 border border-white/20">
            <div class="flex flex-col md:flex-row items-center justify-between mb-6">
                <h2 class="text-2xl md:text-3xl font-semibold text-white mb-4 md:mb-0">ç¸½é«”é€²åº¦</h2>
                <div class="flex items-center space-x-6">
                    <div class="text-center">
                        <div class="text-3xl md:text-4xl font-bold text-white" id="completedCount">0</div>
                        <div class="text-base text-blue-200">å·²å®Œæˆ</div>
                    </div>
                    <div class="relative w-16 h-16 md:w-20 md:h-20">
                        <svg class="progress-ring w-full h-full" viewBox="0 0 120 120">
                            <circle class="progress-ring-circle stroke-white/20" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/>
                            <circle class="progress-ring-circle stroke-green-400" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.73" stroke-dashoffset="326.73" id="progressCircle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-white font-bold text-sm" id="progressPercent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-green-500/20 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-green-300" id="completedTasks">0</div>
                    <div class="text-green-200 text-base">å·²å®Œæˆ</div>
                </div>
                <div class="bg-yellow-500/20 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-yellow-300" id="inProgressTasks">0</div>
                    <div class="text-yellow-200 text-base">é€²è¡Œä¸­</div>
                </div>
                <div class="bg-blue-500/20 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-blue-300" id="notStartedTasks">31</div>
                    <div class="text-blue-200 text-base">æœªé–‹å§‹</div>
                </div>
                <div class="bg-purple-500/20 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-purple-300" id="totalTasks">26</div>
                    <div class="text-purple-200 text-base">å¿…ä¿®é—œå¡</div>
                </div>
            </div>
        </div>
        <div class="mb-8">
            <h3 class="text-xl font-semibold text-white mb-4">ä»»å‹™åˆ†é¡</h3>
            <div class="flex flex-wrap gap-2" id="categoryFilters">
                <button type="button" class="category-filter active bg-white/10 backdrop-blur-lg px-4 py-2 rounded-full text-white text-base font-medium border border-white/20" data-category="all">å…¨éƒ¨ (26å¿…ä¿®+5é¸ä¿®)</button>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="taskContainer"></div>
        <div id="celebrationModal" class="fixed inset-0 bg-black/50 modal-overlay hidden items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center transform scale-95 transition-transform">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">æ­å–œå®Œæˆä»»å‹™ï¼</h3>
                <p class="text-gray-600 mb-6" id="celebrationText">ä½ å·²ç¶“å®Œæˆäº†ä¸€å€‹é‡è¦çš„é‡Œç¨‹ç¢‘ï¼</p>
                <button type="button" id="closeCelebrationBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all">ç¹¼çºŒåŠ æ²¹ï¼</button>
            </div>
        </div>
    </div>

    <div id="adminLoginScreen" class="min-h-screen items-center justify-center px-4 hidden">
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-white/20">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">ğŸ” å°å¸«ç™»å…¥</h1>
                <p class="text-blue-300">è«‹è¼¸å…¥å°å¸«å¯†ç¢¼</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-white text-sm font-medium mb-2">å°å¸«å¯†ç¢¼</label>
                    <input type="password" id="adminPassword" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="è«‹è¼¸å…¥å°å¸«å¯†ç¢¼">
                </div>
                <button type="button" id="adminLoginBtn" class="w-full bg-gradient-to-r from-red-600 to-orange-600 text-white py-3 rounded-lg font-semibold hover:from-red-700 hover:to-orange-700 transition-all">ç™»å…¥å°å¸«å¾Œå°</button>
            </div>
            <div class="mt-6 text-center">
                <button type="button" id="hideAdminBtn" class="text-blue-300 hover:text-blue-200 text-sm underline">è¿”å›å°ç”Ÿç™»å…¥</button>
            </div>
        </div>
    </div>

    <div id="adminPanelScreen" class="min-h-screen px-4 py-8 hidden">
        <div class="container mx-auto max-w-6xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">ğŸ” å°å¸«å¾Œå°</h1>
                <p class="text-blue-300">BNIé›²è²´åˆ†æœƒæ–°æ‰‹æ‘ç®¡ç†ç³»çµ±</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
                <button type="button" id="showAddMemberBtn" class="bg-orange-600 hover:bg-orange-700 text-white p-4 rounded-lg font-semibold transition-all">â• æ–°å¢å°ç”Ÿ</button>
                <button type="button" id="showMemberListBtn" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg font-semibold transition-all">ğŸ“Š æ’è¡Œæ¦œ</button>
                <button type="button" id="showMemberMgmtBtn" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg font-semibold transition-all">ğŸ‘¥ å°ç”Ÿç®¡ç†</button>
                <button type="button" id="showGuestListBtn" class="bg-teal-600 hover:bg-teal-700 text-white p-4 rounded-lg font-semibold transition-all">ğŸ“ ä¾†è³“åå–®</button>
                <button type="button" id="showCalendarMgmtBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white p-4 rounded-lg font-semibold transition-all">ğŸ“… è¡Œäº‹æ›†</button>
                <button type="button" id="showPasswordSettingsBtn" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg font-semibold transition-all">ğŸ”‘ å¯†ç¢¼è¨­å®š</button>
            </div>
            <div id="addMemberSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-white">æ–°å¢å°ç”Ÿ</h2>
                    <button type="button" class="hide-section-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">æ”¶èµ·</button>
                </div>
                <div class="space-y-4">
                    <div class="bg-white/5 rounded-lg p-4">
                        <h3 class="text-white font-semibold mb-3">å»ºç«‹æ–°å°ç”Ÿå¸³è™Ÿ</h3>
                        <div class="space-y-3">
                            <input type="text" id="newMemberName" placeholder="å°ç”Ÿå§“å" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="text" id="newMemberIndustry" placeholder="è¡Œæ¥­åˆ¥ (é¸å¡«)" class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="password" id="newMemberPassword" placeholder="è¨­å®šå¯†ç¢¼ (é¸å¡«ï¼Œç•™ç©ºè¡¨ç¤ºç„¡å¯†ç¢¼)" class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <button type="button" id="createMemberBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 rounded-lg font-semibold transition-all">å»ºç«‹å°ç”Ÿ</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="memberRankingSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-white">å°ç”Ÿæ’è¡Œæ¦œ</h2>
                    <button type="button" class="hide-section-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">æ”¶èµ·</button>
                </div>
                <div class="space-y-3" id="adminRankingList"></div>
            </div>
            <div id="memberManagementSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-white">å°ç”Ÿç®¡ç†</h2>
                    <button type="button" class="hide-section-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">æ”¶èµ·</button>
                </div>
                <div id="adminManagementList"></div>
            </div>
            <div id="guestListAdminSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20 hidden">
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-white">ä¾†è³“ç®¡ç†åå–®</h2>
                    <button type="button" class="hide-section-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">æ”¶èµ·</button>
                </div>
                <div id="adminGuestListContainer"></div>
            </div>
            <div id="calendarManagementSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20 hidden">
                <div class="flex justify-between items-center mb-4">
                   <h2 class="text-xl font-semibold text-white">è¡Œäº‹æ›†ç®¡ç†</h2>
                   <button type="button" class="hide-section-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">æ”¶èµ·</button>
               </div>
               <div class="bg-white/5 rounded-lg p-4 mb-6">
                   <h3 class="text-white font-semibold mb-3">æ–°å¢æ´»å‹•</h3>
                   <div class="space-y-3">
                       <input type="date" id="eventDate" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" style="color-scheme: dark;">
                       <input type="text" id="eventTitle" placeholder="æ´»å‹•æ¨™é¡Œ" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                       <textarea id="eventDescription" placeholder="æ´»å‹•èªªæ˜ (é¸å¡«)" rows="2" class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
                       <button type="button" id="addEventBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded-lg font-semibold transition-all">æ–°å¢æ´»å‹•</button>
                   </div>
               </div>
               <div>
                   <h3 class="text-white font-semibold mb-3">æ´»å‹•åˆ—è¡¨</h3>
                   <div id="adminCalendarList" class="space-y-3"></div>
               </div>
           </div>
            <div id="passwordSettingsSection" class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-white">å¯†ç¢¼è¨­å®š</h2>
                    <button type="button" class="hide-section-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition-all">æ”¶èµ·</button>
                </div>
                <div class="space-y-4">
                    <div class="bg-white/5 rounded-lg p-4">
                        <h3 class="text-white font-semibold mb-3">æ›´æ”¹å°å¸«å¯†ç¢¼</h3>
                        <div class="space-y-3">
                            <input type="password" id="oldAdminPassword" placeholder="è¼¸å…¥èˆŠå¯†ç¢¼" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="password" id="newAdminPassword" placeholder="è¼¸å…¥æ–°å¯†ç¢¼" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <button type="button" id="changePasswordBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-semibold transition-all">æ›´æ”¹å¯†ç¢¼</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center space-y-4">
                <button type="button" id="clearAllDataBtn" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-all">âš ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
                <p class="text-red-300 text-sm">æ³¨æ„ï¼šæ­¤æ“ä½œå°‡æœƒè®“ä½ çŸ¥é“ä¸»å¸­å–œæ­¡èª°(æ­¡è¿é»æ“Š)ï¼</p>
                <button type="button" id="hideAdminPanelBtn" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-semibold transition-all">è¿”å›ç™»å…¥é é¢</button>
            </div>
        </div>
    </div>
    <div id="memberTaskModal" class="fixed inset-0 bg-black/50 modal-overlay hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-4xl max-h-[80vh] overflow-y-auto mx-4 w-full" id="memberTaskModalContentWrapper">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800" id="memberTaskModalTitle">å°ç”Ÿä»»å‹™ç®¡ç†</h3>
                <button type="button" id="closeMemberTaskBtn" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            <div id="memberTaskModalContent"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        (function() {
            'use strict';
            
            const SUPABASE_URL = 'https://hdssnsnkagfjfbuvgfkn.supabase.co'; 
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhkc3Nuc25rYWdmamZidXZnZmtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MjAyMDksImV4cCI6MjA3MzE5NjIwOX0.UoSKuEbguyE-I2j8gRO_mclOffwkV6WFLwayjrkFsuY'; 
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            let currentMember = null;
            let tasks = []; 
            
            const tasksTemplate = [
                { id: 1, title: "æ–°æ‰‹åŒ…", description: "æ”¶åˆ°å€åŸŸå¯„é€çš„å°ç”Ÿæ–°æ‰‹åŒ…", icon: "ğŸ“¦", difficulty: "åŸºç¤", reward: "æ–°æ‰‹è³‡æ–™åŒ…", category: "å…¥é–€æº–å‚™", completionCondition: "æ”¶åˆ°å€åŸŸå¯„é€çš„å°ç”Ÿæ–°æ‰‹åŒ…", isRequired: true },
                { id: 2, title: "åç‰Œ", description: "è£½ä½œå€‹äººå°ˆå±¬çš„BNIåç‰Œ", icon: "ğŸ·ï¸", difficulty: "åŸºç¤", reward: "å€‹äººåç‰Œ", category: "å…¥é–€æº–å‚™", completionCondition: "è£½ä½œåç‰Œ", isRequired: true },
                { id: 3, title: "åƒåŠ 25så°ˆæ¥­ç°¡å ±åŸ¹è¨“", description: "è§€çœ‹25ç§’å°ˆæ¥­ç°¡å ±æ•™å­¸å½±ç‰‡", icon: "ğŸ¤", difficulty: "åŸºç¤", reward: "ç°¡å ±æŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 4, title: "ã€å°å¸«è€ƒæ ¸ã€‘æ¯å‘¨25så°ˆæ¥­ç°¡å ±", description: "é€šéå°å¸«è€ƒæ ¸ï¼Œå±•ç¤º25ç§’å°ˆæ¥­ç°¡å ±èƒ½åŠ›", icon: "âœ…", difficulty: "è€ƒæ ¸", reward: "ç°¡å ±èªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 5, title: "ã€å°å¸«è€ƒæ ¸ã€‘25ç§’è‡ªæˆ‘ä»‹ç´¹åŠSlogan", description: "å®Œæˆ25ç§’è‡ªæˆ‘ä»‹ç´¹å’Œå€‹äººSloganå±•ç¤º", icon: "ğŸ—£ï¸", difficulty: "è€ƒæ ¸", reward: "è‡ªæˆ‘ä»‹ç´¹èªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 6, title: "åƒåŠ Connectç³»çµ±é–‹é€š&æ“ä½œåŸ¹è¨“", description: "è§€çœ‹Connectç³»çµ±æ•™å­¸å½±ç‰‡(å…±2éƒ¨)", icon: "ğŸ’»", difficulty: "åŸºç¤", reward: "ç³»çµ±æ“ä½œæŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 7, title: "ã€å°å¸«è€ƒæ ¸ã€‘Connectç³»çµ±é–‹é€š&æ“ä½œ", description: "é€šéConnectç³»çµ±é–‹é€š&æ“ä½œè€ƒæ ¸", icon: "ğŸ”—", difficulty: "è€ƒæ ¸", reward: "ç³»çµ±æ“ä½œèªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 8, title: "åƒåŠ ç›®æ¨™è¨­å®šåŸ¹è¨“", description: "è§€çœ‹ç›®æ¨™è¨­å®šæ•™å­¸å½±ç‰‡", icon: "ğŸ¯", difficulty: "åŸºç¤", reward: "ç›®æ¨™è¦åŠƒæŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 9, title: "ã€å°å¸«è€ƒæ ¸ã€‘ç›®æ¨™è¨­å®š", description: "å®Œæˆå€‹äººç›®æ¨™è¨­å®šä¸¦é€šéå°å¸«è€ƒæ ¸", icon: "ğŸ“Š", difficulty: "è€ƒæ ¸", reward: "ç›®æ¨™è¨­å®šèªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 10, title: "åƒåŠ äººè„ˆåˆä½œè®Šç¾è¡¨åŸ¹è¨“", description: "è§€çœ‹äººè„ˆåˆä½œè®Šç¾è¡¨æ•™å­¸å½±ç‰‡", icon: "ğŸ’°", difficulty: "é€²éš", reward: "è®Šç¾æŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 11, title: "ã€å°å¸«è€ƒæ ¸ã€‘äººè„ˆåˆä½œè®Šç¾è¡¨", description: "å®Œæˆäººè„ˆåˆä½œè®Šç¾è¡¨ä¸¦é€šéè€ƒæ ¸", icon: "ğŸ’", difficulty: "è€ƒæ ¸", reward: "è®Šç¾è¡¨èªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 12, title: "æ–°æœƒå“¡è¦‹é¢æœƒ", description: "åƒèˆ‡æ¯æœˆä¸€æ¬¡ç”±å€åŸŸæ’å®šæ™‚é–“çš„æ–°äººè¦‹é¢æœƒ", icon: "ğŸ¤", difficulty: "åŸºç¤", reward: "äººè„ˆå»ºç«‹", category: "å¯¦é«”æ´»å‹•", completionCondition: "åƒèˆ‡æ¯æœˆä¸€æ¬¡ç”±å€åŸŸæ’å®šæ™‚é–“çš„æ–°äººè¦‹é¢æœƒ(ä¸€å€‹æœˆåªæœ‰ä¸€æ¬¡å¾ˆé‡è¦)", isRequired: true },
                { id: 13, title: "FBå€åŸŸç²‰å°ˆæŒ‰è®š", description: "é›²è²´åˆ†æœƒFBé»è®š", icon: "ğŸ‘", difficulty: "åŸºç¤", reward: "ç¤¾ç¾¤é€£çµ", category: "ç¤¾äº¤æ´»å‹•", completionCondition: "é›²è²´åˆ†æœƒFBé»è®š", fbUrl: "https://www.facebook.com/bni.yungui", isRequired: true },
                { id: 14, title: "åˆéšMSP", description: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹(èˆ‡é€²éšMSPæ“‡ä¸€å³å¯)", icon: "ğŸ“ˆ", difficulty: "é€²éš", reward: "åˆéšMSPè­‰æ›¸", category: "ç·šä¸Šèª²ç¨‹", completionCondition: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹(èˆ‡15é …æ“‡ä¸€å³å¯)", courseUrl: "https://ally.nime.com.tw/html/memberLogin", isRequired: true },
                { id: 15, title: "é€²éšMSP", description: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹(èˆ‡åˆéšMSPæ“‡ä¸€å³å¯)", icon: "ğŸš€", difficulty: "é€²éš", reward: "é€²éšMSPè­‰æ›¸", category: "ç·šä¸Šèª²ç¨‹", completionCondition: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹(èˆ‡14é …æ“‡ä¸€å³å¯)", courseUrl: "https://ally.nime.com.tw/html/memberLogin", isRequired: true },
                { id: 16, title: "æœƒå“¡æˆåŠŸè—åœ–", description: "åƒèˆ‡å°å¸«å…«å‘¨ç‰¹å®šä¸»é¡Œ", icon: "ğŸ—ºï¸", difficulty: "é€²éš", reward: "æˆåŠŸè—åœ–", category: "å°å¸«å…«å‘¨", completionCondition: "åƒèˆ‡å°å¸«å…«å‘¨ç‰¹å®šä¸»é¡Œ", isRequired: true },
                { id: 17, title: "æ–°æœƒå“¡è­·ç…§", description: "åƒèˆ‡å°å¸«å…«å‘¨ç‰¹å®šä¸»é¡Œ", icon: "ğŸ“˜", difficulty: "é€²éš", reward: "å°ç”Ÿè­·ç…§", category: "å°å¸«å…«å‘¨", completionCondition: "åƒèˆ‡å°å¸«å…«å‘¨ç‰¹å®šä¸»é¡Œ", isRequired: true },
                { id: 18, title: "å°å¸«å…«å‘¨", description: "åƒèˆ‡4æ¬¡æ¯å‘¨å››å°å¸«å…«å‘¨", icon: "ğŸ§™â€â™‚ï¸", difficulty: "é€²éš", reward: "å°å¸«æŒ‡å°å®Œæˆè­‰æ›¸", category: "å°å¸«å…«å‘¨", completionCondition: "åƒèˆ‡4æ¬¡æ¯å‘¨å››å°å¸«å…«å‘¨", weeklyTopics: "W1:å°ç”ŸæˆåŠŸè—åœ–/å‡ºå¸­çš„é‡è¦æ€§ W2:è¡Œæ”¿å°çµ„é‹ä½œ/æ˜ç¢ºç›®æ¨™ W3:æ–°å°ç”Ÿè­·ç…§/å‘Šè¨´æˆ‘å€‘æ€éº¼èªª W4:é‚€ç´„ä¾†è³“å¿ƒæ³•èˆ‡æŠ€å·§/å¸¶ä¾†å°é“å…· W5:å°ç”ŸæˆåŠŸè—åœ–/éåŒå‡¡éŸ¿çš„è¦‹è­‰ W6:è¡Œæ”¿å°çµ„é‹ä½œ/ä¸€å°ä¸€æœƒé¢ W7:æ–°å°ç”Ÿè­·ç…§/ç‚ºä»€éº¼è¦å¸¶ä¾†è³“ W8:é‚€ç´„ä¾†è³“å¿ƒæ³•èˆ‡æŠ€å·§/æˆ‘å€‘æ‡‰è©²æ€éº¼åš", isRequired: true, isCountable: true, targetCount: 4 },
                { id: 19, title: "å…¨åœ‹åˆ†äº«æœƒ", description: "åƒèˆ‡æ¯å‘¨ä¸€å…¨åœ‹åˆ†äº«æœƒ1æ¬¡", icon: "ğŸŒŸ", difficulty: "é€²éš", reward: "å…¨åœ‹è¦–é‡", category: "å¤§å‹æ´»å‹•", completionCondition: "åƒèˆ‡æ¯å‘¨ä¸€å…¨åœ‹åˆ†äº«æœƒ1æ¬¡", isRequired: true },
                { id: 20, title: "åƒåŠ ç´…ç¶ ç‡ˆè¨ˆç®—åŸ¹è¨“", description: "è§€çœ‹ç´…ç¶ ç‡ˆè¨ˆç®—æ•™å­¸å½±ç‰‡", icon: "ğŸš¦", difficulty: "é€²éš", reward: "åˆ†ææŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 21, title: "ã€å°å¸«è€ƒæ ¸ã€‘ç´…ç¶ ç‡ˆè¨ˆç®—", description: "é€šéç´…ç¶ ç‡ˆè¨ˆç®—æ–¹æ³•è€ƒæ ¸", icon: "ğŸ“Š", difficulty: "è€ƒæ ¸", reward: "åˆ†æèªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 22, title: "å°å¸«ç¤ºç¯„ä¸€å°ä¸€", description: "é‚€ç´„å°å¸«ç”±å°å¸«ç¤ºç¯„ä¸€å°ä¸€", icon: "ğŸ‘ï¸", difficulty: "é€²éš", reward: "å¯¦æˆ°ç¶“é©—", category: "å¯¦æˆ°å­¸ç¿’", completionCondition: "é‚€ç´„å°å¸«ç”±å°å¸«ç¤ºç¯„ä¸€å°ä¸€", isRequired: true },
                { id: 23, title: "åƒåŠ 1-1è¡¨æ ¼ 1ã€2è¡¨åŸ¹è¨“", description: "è§€çœ‹1-1è¡¨æ ¼æ•™å­¸å½±ç‰‡", icon: "ğŸ“‹", difficulty: "é€²éš", reward: "è¡¨æ ¼æŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 24, title: "ã€å°å¸«è€ƒæ ¸ã€‘å®Œæˆ1-1è¡¨æ ¼ 1ã€2è¡¨", description: "å®Œæˆ1-1è¡¨æ ¼1ã€2è¡¨ä¸¦é€šéè€ƒæ ¸", icon: "âœï¸", difficulty: "è€ƒæ ¸", reward: "è¡¨æ ¼èªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 25, title: "åƒåŠ 1-1è¡¨æ ¼ 3ã€4è¡¨åŸ¹è¨“", description: "è§€çœ‹1-1è¡¨æ ¼æ•™å­¸å½±ç‰‡", icon: "ğŸ“„", difficulty: "é€²éš", reward: "é€²éšè¡¨æ ¼æŠ€èƒ½", category: "å½±ç‰‡åŸ¹è¨“", completionCondition: "è§€çœ‹æ•™å­¸å½±ç‰‡", videoUrl: "https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf", isRequired: true },
                { id: 26, title: "ã€å°å¸«è€ƒæ ¸ã€‘å®Œæˆ1-1è¡¨æ ¼ 3ã€4è¡¨", description: "å®Œæˆ1-1è¡¨æ ¼3ã€4è¡¨ä¸¦é€šéè€ƒæ ¸", icon: "ğŸ“", difficulty: "è€ƒæ ¸", reward: "é€²éšè¡¨æ ¼èªè­‰", category: "å°å¸«è€ƒæ ¸", completionCondition: "å°å¸«è€ƒæ ¸", isRequired: true },
                { id: 27, title: "ç°¡å ±å·¥ä½œåŠ(é¸ä¿®)", description: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹", icon: "ğŸª", difficulty: "é¸ä¿®", reward: "ç°¡å ±å°ˆç²¾æŠ€èƒ½", category: "é¸ä¿®èª²ç¨‹", completionCondition: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹", courseUrl: "https://ally.nime.com.tw/html/memberLogin", isRequired: false },
                { id: 28, title: "ä¸€å°ä¸€å·¥ä½œåŠ(é¸ä¿®)", description: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹", icon: "ğŸ‘¥", difficulty: "é¸ä¿®", reward: "é¢è«‡æŠ€èƒ½", category: "é¸ä¿®èª²ç¨‹", completionCondition: "å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹", courseUrl: "https://ally.nime.com.tw/html/memberLogin", isRequired: false },
                { id: 29, title: "èˆ‡å°å¸«ä¸€å°ä¸€(é¸ä¿®)", description: "é‚€ç´„å°å¸«é€²è¡Œä¸€å°ä¸€é¢è«‡", icon: "ğŸ¯", difficulty: "é¸ä¿®", reward: "å°å¸«æŒ‡å°", category: "é¸ä¿®èª²ç¨‹", completionCondition: "é‚€ç´„å°å¸«ä¸€å°ä¸€", isRequired: false },
                { id: 30, title: "èˆ‡è‘£é¡§å¤§ä½¿ä¸€å°ä¸€(é¸ä¿®)", description: "é‚€ç´„è‘£äº‹é¡§å•å¤§ä½¿é€²è¡Œä¸€å°ä¸€é¢è«‡", icon: "ğŸ‘”", difficulty: "é¸ä¿®", reward: "é«˜éšæŒ‡å°", category: "é¸ä¿®èª²ç¨‹", completionCondition: "é‚€ç´„è‘£é¡§å¤§ä½¿ä¸€å°ä¸€", isRequired: false },
                { id: 31, title: "èˆ‡ä¹é•·ä¸€å°ä¸€(é¸ä¿®)", description: "é‚€ç´„ä¹é•·é€²è¡Œä¸€å°ä¸€é¢è«‡äº¤æµ", icon: "ğŸ†", difficulty: "é¸ä¿®", reward: "é ˜å°æŒ‡å°", category: "é¸ä¿®èª²ç¨‹", completionCondition: "é‚€ç´„ä¹é•·ä¸€å°ä¸€", isRequired: false }
            ];

            function getInitialTasksForDB() {
                return tasksTemplate.map(task => ({
                    id: task.id,
                    status: 'not-started',
                    currentCount: task.isCountable ? 0 : undefined
                }));
            }
            
            function loadTasksFromMemberData(memberTasksProgress) {
                if (!memberTasksProgress) memberTasksProgress = [];
                tasks = tasksTemplate.map(templateTask => {
                    const progress = memberTasksProgress.find(p => p.id === templateTask.id);
                    return {
                        ...templateTask,
                        status: progress ? progress.status : 'not-started',
                        currentCount: progress ? progress.currentCount : (templateTask.isCountable ? 0 : undefined),
                    };
                });
            }

            async function handleLogin() {
                const nameInput = document.getElementById('memberName');
                const passwordInput = document.getElementById('memberPassword');
                const name = nameInput.value.trim();
                const password = passwordInput.value;

                if (!name) return alert('è«‹å¡«å¯«å°ç”Ÿå§“å');

                const { data, error } = await supabaseClient.from('members').select('*').eq('name', name).single();

                if (error || !data) return alert('âŒ å°ç”Ÿä¸å­˜åœ¨æˆ–æŸ¥è©¢å¤±æ•—ï¼');
                if (data.password && data.password !== password) return alert('å¯†ç¢¼éŒ¯èª¤ï¼');
                
                currentMember = data;
                sessionStorage.setItem('currentMemberId', currentMember.id);
                
                loadTasksFromMemberData(currentMember.tasks);
                updateMemberDisplay(currentMember.name);
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                generateCategoryFilters();
                renderTasks();
                updateProgress();
            }

            async function createMember() {
                const nameInput = document.getElementById('newMemberName');
                const industryInput = document.getElementById('newMemberIndustry');
                const passwordInput = document.getElementById('newMemberPassword');
                
                const name = nameInput.value.trim();
                if (!name) return alert('è«‹å¡«å¯«å°ç”Ÿå§“å');

                const { data: existingMember } = await supabaseClient.from('members').select('id').eq('name', name).single();
                if (existingMember) return alert('å°ç”Ÿå§“åå·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨ä¸åŒçš„å§“å');

                const { error } = await supabaseClient.from('members').insert({
                    name: name,
                    industry: industryInput.value.trim() || 'BNIå°ç”Ÿ',
                    password: passwordInput.value || null,
                    tasks: getInitialTasksForDB()
                });

                if (error) {
                    alert('å»ºç«‹å°ç”Ÿå¤±æ•—ï¼š' + error.message);
                } else {
                    const passwordInfo = passwordInput.value ? `å¯†ç¢¼ï¼š${passwordInput.value}` : 'ç„¡å¯†ç¢¼';
                    alert(`âœ… å°ç”Ÿå»ºç«‹æˆåŠŸï¼\n\nå§“åï¼š${name}\n${passwordInfo}`);
                    nameInput.value = '';
                    industryInput.value = '';
                    passwordInput.value = '';
                }
            }
            
            async function saveTasksToDB() {
                if (!currentMember) return;
                
                const tasksProgressToSave = tasks.map(t => ({
                    id: t.id,
                    status: t.status,
                    currentCount: t.isCountable ? t.currentCount : undefined
                }));

                const { error } = await supabaseClient
                    .from('members')
                    .update({ tasks: tasksProgressToSave })
                    .eq('id', currentMember.id);
                
                if (error) {
                    console.error("Failed to save progress:", error);
                    alert("é€²åº¦å„²å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
                }
            }
            
            function logout() {
                currentMember = null;
                sessionStorage.removeItem('currentMemberId');
                localStorage.removeItem('graduationCelebrated');
                
                document.getElementById('memberName').value = '';
                document.getElementById('memberPassword').value = '';
                
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('adminPanelScreen').classList.add('hidden');
                document.getElementById('adminLoginScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                showLoginRanking();
                showPublicGuestList(); 
                showPublicCalendar();
            }
            
            async function checkSession() {
                const memberId = sessionStorage.getItem('currentMemberId');
                if (memberId) {
                    const { data, error } = await supabaseClient.from('members').select('*').eq('id', parseInt(memberId)).single();
                    if (data && !error) {
                        currentMember = data;
                        loadTasksFromMemberData(currentMember.tasks);
                        updateMemberDisplay(currentMember.name);
                        document.getElementById('loginScreen').classList.add('hidden');
                        document.getElementById('mainContent').classList.remove('hidden');
                        generateCategoryFilters();
                        renderTasks();
                        updateProgress();
                    } else {
                        sessionStorage.removeItem('currentMemberId');
                    }
                }
            }
            
            let currentFilter = 'all';

            function updateTaskStatus(taskId, newStatus) {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    const oldStatus = task.status;
                    task.status = newStatus;
                    if (task.isCountable && newStatus === 'not-started') task.currentCount = 0;
                    if (oldStatus !== 'completed' && newStatus === 'completed') showCelebration(task.title);
                    renderTasks();
                    updateProgress();
                    saveTasksToDB();
                }
            }

            function incrementCount(taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task && task.isCountable && (task.currentCount || 0) < task.targetCount) {
                    task.currentCount = (task.currentCount || 0) + 1;
                    if (task.currentCount === 1 && task.status === 'not-started') task.status = 'in-progress';
                    if (task.currentCount === task.targetCount) {
                        task.status = 'completed';
                        showCelebration(task.title);
                    }
                    renderTasks();
                    updateProgress();
                    saveTasksToDB();
                }
            }

            function decrementCount(taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task && task.isCountable && (task.currentCount || 0) > 0) {
                    task.currentCount--;
                    if (task.currentCount === 0) task.status = 'not-started';
                    else if (task.currentCount < task.targetCount) task.status = 'in-progress';
                    renderTasks();
                    updateProgress();
                    saveTasksToDB();
                }
            }
            
            function updateMemberDisplay(name) {
                document.getElementById('displayMemberName').textContent = name;
                document.getElementById('memberAvatar').textContent = name.charAt(0).toUpperCase();
            }

            async function showLoginRanking() {
                const { data: members, error } = await supabaseClient.from('members').select('name, industry, created_at, tasks');
                if (error) {
                    console.error("Error fetching members for ranking:", error);
                    return;
                }
                
                const ranking = [];
                const graduated = [];

                members.forEach(member => {
                    const progress = calculateMemberProgress(member.tasks);
                    const memberData = { name: member.name, industry: member.industry, joinDate: member.created_at, ...progress };
                    if (progress.percentage >= 100) graduated.push(memberData);
                    else ranking.push(memberData);
                });

                ranking.sort((a, b) => b.percentage - a.percentage || b.completedCount - a.completedCount);
                graduated.sort((a, b) => new Date(a.joinDate) - new Date(b.joinDate));
                
                const graduatedSection = document.getElementById('graduatedMembersSection');
                const graduatedList = document.getElementById('graduatedMembersList');
                if (graduated.length > 0) {
                    graduatedList.innerHTML = graduated.map(member => {
                        const joinDate = new Date(member.joinDate).toLocaleDateString('zh-TW');
                        return `<div class="bg-gradient-to-r from-yellow-500/30 to-orange-500/30 rounded-lg p-4 border border-yellow-400/50"><div class="flex items-center space-x-3"><div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center text-white font-bold">${member.name.charAt(0).toUpperCase()}</div><div class="flex-1"><h3 class="text-yellow-100 font-semibold text-lg">${member.name}</h3><p class="text-yellow-200 text-sm">${member.industry}</p><p class="text-yellow-300 text-xs">å‡ºæ‘æ—¥æœŸï¼š${joinDate}</p></div><div class="text-3xl">ğŸ“</div></div></div>`;
                    }).join('');
                    graduatedSection.classList.remove('hidden');
                } else {
                    graduatedSection.classList.add('hidden');
                }

                const rankingSection = document.getElementById('loginRankingSection');
                const rankingList = document.getElementById('loginRankingList');
                if (ranking.length > 0) {
                    rankingList.innerHTML = ranking.slice(0, 10).map((member, index) => {
                        const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;
                        const joinDate = new Date(member.joinDate).toLocaleDateString('zh-TW');
                        return `<div class="bg-white/5 rounded-lg p-4 flex items-center justify-between hover:bg-white/10 transition-all"><div class="flex items-center space-x-4"><div class="text-2xl font-bold text-white w-8 text-center">${rankIcon}</div><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold">${member.name.charAt(0).toUpperCase()}</div><div><h3 class="text-white font-semibold">${member.name}</h3><p class="text-blue-200 text-sm">${member.industry}</p><p class="text-blue-300 text-xs">åŠ å…¥ï¼š${joinDate}</p></div></div><div class="text-right"><div class="text-2xl font-bold text-white">${member.percentage}%</div><div class="text-blue-200 text-sm">${member.completedCount}/${member.totalCount} å¿…ä¿®</div><div class="text-blue-300 text-xs">å®Œæˆ${member.completed} | é€²è¡Œ${member.inProgress}</div></div></div>`;
                    }).join('');
                    if (ranking.length > 10) rankingList.innerHTML += `<div class="text-center text-blue-300 text-sm py-2">é‚„æœ‰ ${ranking.length - 10} ä½å°ç”Ÿæœªé¡¯ç¤º...</div>`;
                    rankingSection.classList.remove('hidden');
                } else if (graduated.length === 0) {
                    rankingList.innerHTML = '<div class="text-center text-blue-300 py-8">ç›®å‰é‚„æ²’æœ‰å°ç”Ÿè³‡æ–™</div>';
                    rankingSection.classList.remove('hidden');
                } else {
                    rankingSection.classList.add('hidden');
                }
            }
            
            function calculateMemberProgress(memberTasks) {
                if (!memberTasks) return { completedCount: 0, totalCount: 0, percentage: 0, completed: 0, inProgress: 0 };
                let requiredCompletedCount = 0, requiredTotalCount = 0, mspProcessed = false;
                const completed = memberTasks.filter(t => t.status === 'completed').length;
                const inProgress = memberTasks.filter(t => t.status === 'in-progress').length;
                tasksTemplate.filter(t => t.isRequired).forEach(task => {
                    const memberTask = memberTasks.find(mt => mt.id === task.id);
                    if (task.id === 14 || task.id === 15) {
                        if (!mspProcessed) {
                            requiredTotalCount++;
                            if (memberTasks.some(mt => (mt.id === 14 || mt.id === 15) && mt.status === 'completed')) requiredCompletedCount++;
                            mspProcessed = true;
                        }
                    } else if (task.isCountable) {
                        requiredTotalCount++;
                        requiredCompletedCount += (memberTask?.currentCount || 0) / task.targetCount;
                    } else {
                        requiredTotalCount++;
                        if (memberTask?.status === 'completed') requiredCompletedCount++;
                    }
                });
                const percentage = requiredTotalCount > 0 ? Math.round((requiredCompletedCount / requiredTotalCount) * 100) : 0;
                return { completedCount: Math.floor(requiredCompletedCount), totalCount: requiredTotalCount, percentage, completed, inProgress };
            }

            function generateCategoryFilters() {
                const categories = [...new Set(tasksTemplate.map(task => task.category))];
                const container = document.getElementById('categoryFilters');
                const allButton = container.querySelector('[data-category="all"]');
                container.innerHTML = '';
                container.appendChild(allButton);
                const requiredCount = tasksTemplate.filter(t => t.isRequired).length;
                const optionalCount = tasksTemplate.filter(t => !t.isRequired).length;
                allButton.textContent = `å…¨éƒ¨ (${requiredCount - 1}å¿…ä¿®+${optionalCount}é¸ä¿®)`;
                categories.forEach(category => {
                    const count = tasksTemplate.filter(task => task.category === category).length;
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'category-filter bg-white/10 backdrop-blur-lg px-4 py-2 rounded-full text-white text-base font-medium border border-white/20';
                    button.setAttribute('data-category', category);
                    button.textContent = `${category} (${count})`;
                    button.addEventListener('click', () => filterTasks(category));
                    container.appendChild(button);
                });
            }
            function filterTasks(category) {
                currentFilter = category;
                document.querySelectorAll('.category-filter').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-category="${category}"]`).classList.add('active');
                renderTasks();
            }
            function renderTasks() {
                const container = document.getElementById('taskContainer');
                container.innerHTML = '';
                const filteredTasks = currentFilter === 'all' ? tasks : tasks.filter(task => task.category === currentFilter);
                filteredTasks.forEach(task => {
                    const statusClass = task.status === 'completed' ? 'completed' : task.status === 'in-progress' ? 'in-progress' : 'not-started';
                    const statusText = task.status === 'completed' ? 'å·²å®Œæˆ' : task.status === 'in-progress' ? 'é€²è¡Œä¸­' : 'æœªé–‹å§‹';
                    const statusIcon = task.status === 'completed' ? 'âœ…' : task.status === 'in-progress' ? 'â³' : 'â­•';
                    const difficultyColor = task.difficulty === 'åŸºç¤' ? 'text-green-400' : task.difficulty === 'é€²éš' ? 'text-yellow-400' : task.difficulty === 'è€ƒæ ¸' ? 'text-red-400' : task.difficulty === 'é¸ä¿®' ? 'text-purple-400' : 'text-orange-400';
                    const countDisplay = task.isCountable ? `<div class="bg-blue-500/20 rounded-lg p-2 mb-3"><div class="flex items-center justify-between"><span class="text-xs text-blue-300">é€²åº¦</span><span class="text-sm font-bold text-blue-200">${task.currentCount || 0}/${task.targetCount}</span></div><div class="w-full bg-white/10 rounded-full h-2 mt-1"><div class="bg-blue-400 h-2 rounded-full transition-all" style="width: ${((task.currentCount || 0) / task.targetCount) * 100}%"></div></div></div>` : '';
                    const card = document.createElement('div');
                    card.className = `task-card bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20 ${statusClass}`;
                    card.innerHTML = `
                        <div class="flex items-start justify-between mb-3"><div class="text-3xl">${task.icon}</div><div class="flex items-center space-x-2"><span class="text-sm ${statusIcon === 'âœ…' ? 'text-green-300' : statusIcon === 'â³' ? 'text-yellow-300' : 'text-blue-300'}">${statusIcon}</span><span class="text-xs ${statusIcon === 'âœ…' ? 'text-green-300' : statusIcon === 'â³' ? 'text-yellow-300' : 'text-blue-300'}">${statusText}</span></div></div>
                        <h3 class="text-xl font-semibold text-white mb-2 leading-tight">${task.title}</h3> <p class="text-blue-200 mb-3 text-base leading-relaxed">${task.description}</p> ${countDisplay}
                        <div class="flex items-center justify-between mb-3"><span class="text-sm ${difficultyColor} font-medium px-2 py-1 bg-white/10 rounded">${task.difficulty}</span><span class="text-sm text-purple-300">ğŸ ${task.reward}</span></div>
                        <div class="text-sm text-blue-300 mb-3">${task.category}</div>
                        <div class="bg-white/5 rounded-lg p-3 mb-3">
                            <div class="text-sm text-gray-300 mb-1">å®Œæˆæ¢ä»¶ï¼š</div><div class="text-sm text-white">${task.completionCondition}</div>
                            ${task.videoUrl ? `<div class="mt-2"><button type="button" class="external-link-btn inline-flex items-center text-sm text-blue-300 hover:text-blue-200" data-url="${task.videoUrl}">ğŸ“¹ è§€çœ‹æ•™å­¸å½±ç‰‡</button></div>` : ''}
                            ${task.fbUrl ? `<div class="mt-2"><button type="button" class="external-link-btn inline-flex items-center text-sm text-blue-300 hover:text-blue-200" data-url="${task.fbUrl}">ğŸ‘ å‰å¾€FBç²‰å°ˆ</button></div>` : ''}
                            ${task.courseUrl ? `<div class="mt-2"><button type="button" class="external-link-btn inline-flex items-center text-sm text-blue-300 hover:text-blue-200" data-url="${task.courseUrl}">ğŸ“š å‰å¾€èª²ç¨‹å ±å</button></div>` : ''}
                        </div>
                        <div class="flex space-x-2">
                            ${task.category === 'å°å¸«è€ƒæ ¸' ? `<div class="flex-1 text-center py-2 px-3 bg-orange-600/50 text-orange-200 rounded-lg text-base">âš ï¸ åƒ…å°å¸«å¯æ“ä½œ</div>` : task.isCountable ? `${(task.currentCount || 0) < task.targetCount ? `<button type="button" class="increment-btn flex-1 py-2 px-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium" data-task-id="${task.id}">+1 æ¬¡åƒèˆ‡</button>` : ''}${(task.currentCount || 0) > 0 ? `<button type="button" class="decrement-btn py-2 px-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium" data-task-id="${task.id}">-1</button>` : ''}` : `${task.status !== 'completed' ? `<button type="button" class="update-status-btn flex-1 py-2 px-3 rounded-lg font-medium ${task.status === 'not-started' ? 'bg-blue-600 hover:bg-blue-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white'}" data-task-id="${task.id}" data-new-status="${task.status === 'not-started' ? 'in-progress' : 'completed'}">${task.status === 'not-started' ? 'é–‹å§‹' : 'å®Œæˆ'}</button>` : ''}${task.status !== 'not-started' ? `<button type="button" class="reset-status-btn py-2 px-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium" data-task-id="${task.id}">é‡ç½®</button>` : ''}`}
                        </div>`;
                    container.appendChild(card);
                });
                bindTaskEvents();
            }
            function bindTaskEvents() {
                document.querySelectorAll('.external-link-btn').forEach(btn => btn.addEventListener('click', function(e) { e.stopPropagation(); openExternalLink(this.dataset.url); }));
                document.querySelectorAll('.increment-btn').forEach(btn => btn.addEventListener('click', function(e) { e.stopPropagation(); incrementCount(parseInt(this.dataset.taskId)); }));
                document.querySelectorAll('.decrement-btn').forEach(btn => btn.addEventListener('click', function(e) { e.stopPropagation(); decrementCount(parseInt(this.dataset.taskId)); }));
                document.querySelectorAll('.update-status-btn').forEach(btn => btn.addEventListener('click', function(e) { e.stopPropagation(); updateTaskStatus(parseInt(this.dataset.taskId), this.dataset.newStatus); }));
                document.querySelectorAll('.reset-status-btn').forEach(btn => btn.addEventListener('click', function(e) { e.stopPropagation(); updateTaskStatus(parseInt(this.dataset.taskId), 'not-started'); }));
            }
            function showCelebration(taskTitle) {
                const modal = document.getElementById('celebrationModal');
                modal.querySelector('h3').textContent = 'æ­å–œå®Œæˆä»»å‹™ï¼';
                modal.querySelector('.text-6xl').textContent = 'ğŸ‰';
                modal.querySelector('#celebrationText').textContent = `ä½ å·²ç¶“å®Œæˆäº†ã€Œ${taskTitle}ã€ä»»å‹™ï¼`;
                modal.querySelector('button').textContent = 'ç¹¼çºŒåŠ æ²¹ï¼';
                modal.classList.add('flex');
                modal.classList.remove('hidden');
                setTimeout(() => { modal.querySelector('div').classList.remove('scale-95'); modal.querySelector('div').classList.add('scale-100'); }, 10);
            }
            function closeCelebration() {
                const modal = document.getElementById('celebrationModal');
                modal.querySelector('div').classList.remove('scale-100');
                modal.querySelector('div').classList.add('scale-95');
                setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('flex'); }, 200);
            }
            function showGraduationCelebration() {
                const modal = document.getElementById('celebrationModal');
                modal.querySelector('h3').textContent = 'ğŸŠ æ­å–œå‡ºæ‘ï¼ğŸŠ';
                modal.querySelector('.text-6xl').textContent = 'ğŸ†';
                modal.querySelector('#celebrationText').textContent = 'æ­å–œä½ å®Œæˆäº†BNIé›²è²´åˆ†æœƒæ–°æ‰‹æ‘çš„æ‰€æœ‰å¿…ä¿®ä»»å‹™ï¼';
                modal.querySelector('button').textContent = 'ç¹¼çºŒåŠ æ²¹ï¼';
                modal.classList.add('flex');
                modal.classList.remove('hidden');
                setTimeout(() => { modal.querySelector('div').classList.remove('scale-95'); modal.querySelector('div').classList.add('scale-100'); }, 10);
            }
            function updateProgress() {
                const completed = tasks.filter(t => t.status === 'completed').length;
                const inProgress = tasks.filter(t => t.status === 'in-progress').length;
                const notStarted = tasks.filter(t => t.status === 'not-started').length;
                const progress = calculateMemberProgress(tasks);
                document.getElementById('completedCount').textContent = `${progress.completedCount}/${progress.totalCount}`;
                document.getElementById('completedTasks').textContent = completed;
                document.getElementById('inProgressTasks').textContent = inProgress;
                document.getElementById('notStartedTasks').textContent = notStarted;
                document.getElementById('progressPercent').textContent = progress.percentage + '%';
                const circle = document.getElementById('progressCircle');
                const circumference = 2 * Math.PI * 52;
                const offset = circumference - (progress.percentage / 100) * circumference;
                circle.style.strokeDashoffset = offset;
                if (progress.percentage === 100 && !localStorage.getItem('graduationCelebrated')) {
                    setTimeout(() => { showGraduationCelebration(); localStorage.setItem('graduationCelebrated', 'true'); }, 1000);
                }
            }
            
            function openExternalLink(url) {
                window.open(url, '_blank', 'noopener,noreferrer');
            }

            function getAdminPassword() { return localStorage.getItem('adminPassword') || 'bni2025'; }
            function setAdminPassword(newPassword) { localStorage.setItem('adminPassword', newPassword); }
            function showAdminLogin() { document.getElementById('loginScreen').classList.add('hidden'); document.getElementById('adminLoginScreen').classList.add('flex'); document.getElementById('adminLoginScreen').classList.remove('hidden');}
            function hideAdminLogin() { document.getElementById('adminLoginScreen').classList.add('hidden'); document.getElementById('adminLoginScreen').classList.remove('flex'); document.getElementById('loginScreen').classList.remove('hidden'); document.getElementById('adminPassword').value = ''; }
            function handleAdminLogin() {
                const password = document.getElementById('adminPassword').value;
                if (password === getAdminPassword()) {
                    document.getElementById('adminLoginScreen').classList.add('hidden');
                    document.getElementById('adminLoginScreen').classList.remove('flex');
                    document.getElementById('adminPassword').value = '';
                    showAdminPanel();
                } else {
                    alert('å¯†ç¢¼éŒ¯èª¤');
                    document.getElementById('adminPassword').value = '';
                }
            }
            function showAdminPanel() { document.getElementById('adminPanelScreen').classList.remove('hidden'); hideAdminSections(); }
            function hideAdminPanel() { document.getElementById('adminPanelScreen').classList.add('hidden'); document.getElementById('loginScreen').classList.remove('hidden'); showLoginRanking(); }
            function hideAdminSections() {
                document.getElementById('addMemberSection').classList.add('hidden');
                document.getElementById('memberRankingSection').classList.add('hidden');
                document.getElementById('memberManagementSection').classList.add('hidden');
                document.getElementById('passwordSettingsSection').classList.add('hidden');
                document.getElementById('guestListAdminSection')?.classList.add('hidden');
                document.getElementById('calendarManagementSection')?.classList.add('hidden');
            }
            function showAddMember() { hideAdminSections(); document.getElementById('addMemberSection').classList.remove('hidden'); }
            
            async function showMemberList() {
                hideAdminSections();
                const container = document.getElementById('adminRankingList');
                container.innerHTML = `<div class="text-white text-center p-8">æ­£åœ¨å¾é›²ç«¯è¼‰å…¥æ’è¡Œæ¦œ...</div>`;
                document.getElementById('memberRankingSection').classList.remove('hidden');

                const { data: members, error } = await supabaseClient.from('members').select('id, name, industry, created_at, tasks');
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-8">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
                    return;
                }

                const ranking = [];
                const graduated = [];
                members.forEach(member => {
                    const progress = calculateMemberProgress(member.tasks);
                    const memberData = { id: member.id, name: member.name, industry: member.industry, joinDate: member.created_at, ...progress };
                    if (progress.percentage >= 100) graduated.push(memberData);
                    else ranking.push(memberData);
                });
                ranking.sort((a, b) => b.percentage - a.percentage || b.completedCount - a.completedCount);
                graduated.sort((a, b) => new Date(a.joinDate) - new Date(b.joinDate));

                let html = '';
                if (graduated.length > 0) {
                     html += `<h3 class="text-lg font-semibold text-yellow-300 mb-3">ğŸ† å·²å‡ºæ‘å°ç”Ÿ (${graduated.length}ä½)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${graduated.map(member => `
                            <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-lg p-3 border border-yellow-400/30">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">${member.name.charAt(0).toUpperCase()}</div>
                                    <div><h4 class="text-yellow-200 font-semibold text-sm">${member.name}</h4><p class="text-yellow-300 text-xs">åŠ å…¥ï¼š${new Date(member.joinDate).toLocaleDateString('zh-TW')}</p></div>
                                    <div class="ml-auto text-yellow-300 text-lg">ğŸ“</div>
                                </div>
                            </div>`).join('')}
                        </div>`;
                }
                if (ranking.length === 0 && graduated.length === 0) {
                     html += '<div class="text-center text-blue-300 py-8">ç›®å‰æ²’æœ‰ä»»ä½•å°ç”Ÿè³‡æ–™</div>';
                } else if (ranking.length > 0) {
                     html += `<h3 class="text-lg font-semibold text-white mt-6 mb-3">ğŸ“Š é€²è¡Œä¸­å°ç”Ÿæ’è¡Œæ¦œ (${ranking.length}ä½)</h3>
                        <div class="space-y-3">
                        ${ranking.map((member, index) => {
                             const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;
                             return `
                                <div class="bg-white/5 rounded-lg p-4 flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <div class="text-2xl font-bold text-white w-8 text-center">${rankIcon}</div>
                                        <div>
                                            <h3 class="text-white font-semibold">${member.name}</h3>
                                            <p class="text-blue-200 text-sm">${member.industry}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-white">${member.percentage}%</div>
                                        <div class="text-blue-200 text-sm">${member.completedCount}/${member.totalCount} å¿…ä¿®</div>
                                    </div>
                                </div>`;
                         }).join('')}
                        </div>`;
                }
                container.innerHTML = html;
            }
            
            async function showMemberManagement() {
                hideAdminSections();
                const container = document.getElementById('adminManagementList');
                container.innerHTML = `<div class="text-white text-center p-8">æ­£åœ¨å¾é›²ç«¯è¼‰å…¥å°ç”Ÿåˆ—è¡¨...</div>`;
                document.getElementById('memberManagementSection').classList.remove('hidden');

                const { data: members, error } = await supabaseClient.from('members').select('*').order('created_at', { ascending: false });
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-8">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
                    return;
                }

                if (members.length === 0) {
                     container.innerHTML = '<div class="text-center text-blue-300 py-8">ç›®å‰æ²’æœ‰ä»»ä½•å°ç”Ÿè³‡æ–™</div>';
                     return;
                }

                container.innerHTML = members.map(member => {
                    const progress = calculateMemberProgress(member.tasks);
                    const hasPassword = member.password ? 'ğŸ”’' : 'ğŸ”“';
                    const statusBadge = progress.percentage >= 100 
                        ? '<span class="bg-yellow-500 text-yellow-900 px-2 py-1 rounded-full text-xs font-semibold">ğŸ“ å·²å‡ºæ‘</span>'
                        : `<span class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-semibold">${progress.percentage}% é€²è¡Œä¸­</span>`;
                    
                    return `
                        <div class="bg-white/5 rounded-lg p-4 mb-3">
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                                <div class="flex items-center space-x-3 mb-3 sm:mb-0">
                                    <div>
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h3 class="text-white font-semibold">${member.name} ${hasPassword}</h3>
                                            ${statusBadge}
                                        </div>
                                        <p class="text-blue-200 text-sm">${member.industry}</p>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2 justify-start sm:justify-end">
                                    <button type="button" onclick="editMember(${member.id}, '${escapeHTML(member.name)}', '${escapeHTML(member.industry)}')" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded text-sm">ä¿®æ”¹è³‡æ–™</button>
                                    <button type="button" onclick="showMemberTasksModal(${member.id})" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm">ç®¡ç†ä»»å‹™</button>
                                    <button type="button" onclick="resetMemberPassword(${member.id}, '${escapeHTML(member.name)}')" class="px-3 py-1 bg-orange-600 hover:bg-orange-700 text-white rounded text-sm">é‡è¨­å¯†ç¢¼</button>
                                    <button type="button" onclick="deleteMember(${member.id}, '${escapeHTML(member.name)}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm">åˆªé™¤å°ç”Ÿ</button>
                                </div>
                            </div>
                        </div>`;
                }).join('');
            }

            async function editMember(memberId, currentName, currentIndustry) {
                const newName = prompt("è«‹è¼¸å…¥å°ç”Ÿæ–°å§“åï¼š", currentName);
                if (newName === null || newName.trim() === '') {
                    return;
                }
                const newIndustry = prompt("è«‹è¼¸å…¥å°ç”Ÿæ–°è¡Œæ¥­åˆ¥ï¼š", currentIndustry);
                if (newIndustry === null) return;

                const { error } = await supabaseClient
                    .from('members')
                    .update({ name: newName.trim(), industry: newIndustry.trim() })
                    .eq('id', memberId);

                if (error) {
                    alert('æ›´æ–°å°ç”Ÿè³‡æ–™å¤±æ•—ï¼š' + error.message);
                } else {
                    alert('å°ç”Ÿè³‡æ–™å·²æˆåŠŸæ›´æ–°ï¼');
                    showMemberManagement();
                }
            }
            window.editMember = editMember;

            async function deleteMember(memberId, memberName) {
                if (confirm(`âš ï¸ ç¢ºå®šè¦åˆªé™¤å°ç”Ÿ ${memberName} å—ï¼Ÿ\næ­¤æ“ä½œå°‡æ°¸ä¹…åˆªé™¤é›²ç«¯è³‡æ–™ï¼Œç„¡æ³•å¾©åŸï¼`)) {
                    const { error } = await supabaseClient.from('members').delete().eq('id', memberId);
                    if (error) {
                        alert(`åˆªé™¤å¤±æ•—ï¼š${error.message}`);
                    } else {
                        alert(`å°ç”Ÿ ${memberName} å·²æˆåŠŸåˆªé™¤ã€‚`);
                        showMemberManagement();
                    }
                }
            }
            window.deleteMember = deleteMember;

            async function resetMemberPassword(memberId, memberName) {
                const newPassword = prompt(`è«‹ç‚º ${memberName} è¨­å®šæ–°å¯†ç¢¼ï¼š\nï¼ˆç•™ç©ºè¡¨ç¤ºç§»é™¤å¯†ç¢¼ï¼Œä½¿ç”¨è€…å°‡ç„¡éœ€å¯†ç¢¼å³å¯ç™»å…¥ï¼‰`);
                if (newPassword !== null) {
                    const { error } = await supabaseClient.from('members').update({ password: newPassword || null }).eq('id', memberId);
                    if (error) {
                         alert(`å¯†ç¢¼é‡è¨­å¤±æ•—ï¼š${error.message}`);
                    } else {
                         alert(`å°ç”Ÿ ${memberName} çš„å¯†ç¢¼å·²æˆåŠŸæ›´æ–°ã€‚`);
                         showMemberManagement();
                    }
                }
            }
            window.resetMemberPassword = resetMemberPassword;

            let currentlyEditingMember = null;
            
            function _renderAdminTasks(member, container) {
                let memberTasksProgress = member.tasks || [];
                container.innerHTML = tasksTemplate.map(taskTpl => {
                    const taskProgress = memberTasksProgress.find(p => p.id === taskTpl.id) || { id: taskTpl.id, status: 'not-started', currentCount: 0 };
                    const statusOptions = ['not-started', 'in-progress', 'completed']
                        .map(s => `<option value="${s}" ${taskProgress.status === s ? 'selected' : ''}>${s === 'not-started' ? 'æœªé–‹å§‹' : s === 'in-progress' ? 'é€²è¡Œä¸­' : 'å·²å®Œæˆ'}</option>`)
                        .join('');
                    const countControls = taskTpl.isCountable
                        ? `<div class="flex items-center space-x-2">
                                <button class="px-2 py-1 bg-gray-300 text-gray-800 rounded hover:bg-gray-400" onclick="adminUpdateTask(${member.id}, ${taskTpl.id}, null, ${Math.max(0, (taskProgress.currentCount || 0) - 1)})">-</button>
                                <span>${taskProgress.currentCount || 0} / ${taskTpl.targetCount}</span>
                                <button class="px-2 py-1 bg-gray-300 text-gray-800 rounded hover:bg-gray-400" onclick="adminUpdateTask(${member.id}, ${taskTpl.id}, null, ${Math.min(taskTpl.targetCount, (taskProgress.currentCount || 0) + 1)})">+</button>
                           </div>` : '';
                    return `<div class="border rounded-lg p-3 mb-2 flex justify-between items-center bg-gray-50">
                            <div class="flex-1"><h4 class="font-semibold text-gray-800">${taskTpl.icon} ${taskTpl.title}</h4></div>
                            <div class="flex items-center space-x-4">${countControls}
                                <select class="text-xs border rounded px-2 py-1" onchange="adminUpdateTask(${member.id}, ${taskTpl.id}, this.value, null)">${statusOptions}</select>
                            </div></div>`;
                }).join('');
            }

            async function showMemberTasksModal(memberId) {
                const modal = document.getElementById('memberTaskModal');
                const title = document.getElementById('memberTaskModalTitle');
                const content = document.getElementById('memberTaskModalContent');
                
                content.innerHTML = `<div class="text-gray-800 text-center p-8">æ­£åœ¨è¼‰å…¥ä»»å‹™è³‡æ–™...</div>`;
                modal.classList.remove('hidden');
                modal.classList.add('flex');

                const { data: member, error } = await supabaseClient.from('members').select('id, name, tasks').eq('id', memberId).single();
                if (error || !member) {
                    content.innerHTML = `<div class="text-red-500 text-center p-8">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
                    return;
                }
                
                currentlyEditingMember = member;
                title.textContent = `${member.name} - ä»»å‹™ç®¡ç†`;
                _renderAdminTasks(member, content);
            }
            window.showMemberTasksModal = showMemberTasksModal;

            async function adminUpdateTask(memberId, taskId, newStatus, newCount) {
                if (!currentlyEditingMember || currentlyEditingMember.id !== memberId) return;

                const contentWrapper = document.getElementById('memberTaskModalContentWrapper');
                const scrollPosition = contentWrapper.scrollTop;
                
                const taskIndex = currentlyEditingMember.tasks.findIndex(t => t.id === taskId);
                
                if (taskIndex !== -1) {
                    const task = currentlyEditingMember.tasks[taskIndex];
                    if (newStatus !== null) task.status = newStatus;
                    if (newCount !== null) task.currentCount = newCount;
                    const taskTpl = tasksTemplate.find(t => t.id === taskId);
                    if (taskTpl.isCountable) {
                        if (task.currentCount > 0 && task.currentCount < taskTpl.targetCount) task.status = 'in-progress';
                        else if (task.currentCount >= taskTpl.targetCount) task.status = 'completed';
                        else task.status = 'not-started';
                    }
                } else {
                     currentlyEditingMember.tasks.push({ id: taskId, status: newStatus || 'not-started', currentCount: newCount });
                }

                const { error } = await supabaseClient
                    .from('members')
                    .update({ tasks: currentlyEditingMember.tasks })
                    .eq('id', memberId);

                if (error) {
                    alert('æ›´æ–°å¤±æ•—: ' + error.message);
                } else {
                    _renderAdminTasks(currentlyEditingMember, document.getElementById('memberTaskModalContent'));
                    contentWrapper.scrollTop = scrollPosition;
                }
            }
            window.adminUpdateTask = adminUpdateTask;

            function closeMemberTaskModal() {
                const modal = document.getElementById('memberTaskModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                currentlyEditingMember = null;
                showMemberManagement();
            }

            function showPasswordSettings() { hideAdminSections(); document.getElementById('passwordSettingsSection').classList.remove('hidden'); }
            function changeAdminPassword() {
                const oldPassword = document.getElementById('oldAdminPassword').value;
                const newPassword = document.getElementById('newAdminPassword').value;
                if (oldPassword !== getAdminPassword()) return alert('èˆŠå¯†ç¢¼éŒ¯èª¤');
                if (newPassword.length < 6) return alert('æ–°å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒ');
                setAdminPassword(newPassword);
                alert('å°å¸«å¯†ç¢¼å·²æ›´æ–°');
                document.getElementById('oldAdminPassword').value = '';
                document.getElementById('newAdminPassword').value = '';
            }
            
            function clearAllData() {
                const prankMessages = [ "æ­å’©!", "çœŸçš„ä¸è¡Œå•¦ï½", "No way!", "Stop clicking me!", "ä½ ä»¥ç‚ºé€™æ¨£æœ‰ç”¨å—ï¼Ÿ", "å—¶å—¶ï¼åµæ¸¬åˆ°æƒ¡æ„æ“ä½œ", "å†æŒ‰æˆ‘è¦å«è­¦å¯Ÿäº†å–”", "æ£®ä¸ƒä¸ƒ", "æ‰‹æŒ‡ä¸é…¸å—ï¼Ÿ", "æ”¾æ£„å§ï¼Œäººé¡", "ç¬¬11æ¬¡äº†...", "ä½ æ˜¯ä¸æ˜¯å¾ˆé–’", "å¥½å§ï¼Œæˆ‘è€ƒæ…®ä¸€ä¸‹...", "è€ƒæ…®çµæœï¼šä¸è¡Œ", "Just... stop.", "æˆ‘æ•¸åˆ°ä¸‰å–”... ä¸€...", "äºŒ...", "... äºŒé»äº” ...", "... äºŒé»å…«ä¸ƒ ...", "ç®—äº†ï¼Œä½ ç¹¼çºŒ", "å˜¿ï¼Œä½ é‚„åœ¨å•Š", "è½èªªå±æ±å¤œå¸‚å¾ˆå¥½é€›", "ä¸è¦å†é»äº†ï¼Œå»é€›å¤œå¸‚å•¦", "å†é»æˆ‘å°±... å‡è£ç•¶æ©Ÿå–”", "ä¸€åŠäº†ï¼Œæ­å–œï¼(ä¸¦æ²’æœ‰)", "è—å±è­¦å‘Š... ", "é–‹ç©ç¬‘çš„ :P ", "Good morning BNI!", "ä»˜å‡ºè€…æ”¶ç©«! ", "ä½ ç¾åœ¨æ­£åœ¨é¨·æ“¾å®ƒ", "æ–½ä¸»ï¼Œå›é ­æ˜¯å²¸", "ä½ çš„æ¯…åŠ›è®“æˆ‘æ„Ÿå‹•", "ä½†æˆ‘é‚„æ˜¯ä¸èƒ½è®“ä½ åˆª", "ä¸ç„¶ä½ è«‹æˆ‘å–æ¯å’–å•¡ï¼Ÿ", "æƒ³å¾—ç¾", "æƒ³çŸ¥é“ä¸»å¸­å–œæ­¡èª°å—? ", "æç¤ºï¼šç”·çš„! ", "æç¤ºï¼šä¹Ÿä¸æ˜¯å¥³çš„! ", "å¥½äº†ï¼Œä¸é¬§äº†", "çœŸçš„å•¦ï¼Œä¸è¦é»äº†", "å€’æ•¸åæ¬¡... ", "ä¹... ", "å…«... ", "ä½ çœŸçš„å¾ˆå …æŒæ¬¸ ", "å…­... ", "äº”... ", "å››...", "æº–å‚™å›å¤§å»³ ", "äºŒ... ", "æœ€å¾Œä¸€æ¬¡ï¼" ];
                for (let i = 0; i < prankMessages.length; i++) { alert(prankMessages[i]); }
                alert("å¥½å•¦ï¼Œæ”¾éä½ ï½ è³‡æ–™æ²’æœ‰è¢«åˆªé™¤å–”ï¼ ğŸ˜‰");
            }
            
            function escapeHTML(str) {
                if (typeof str !== 'string') return str;
                return str.replace(/'/g, "&apos;").replace(/"/g, "&quot;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            }

            // â˜…â˜…â˜… ä¾†è³“åå–®åŠŸèƒ½ (JS) START â˜…â˜…â˜…
            async function showGuestList() {
                hideAdminSections();
                const container = document.getElementById('adminGuestListContainer');
                container.innerHTML = `<div class="text-white text-center p-8">æ­£åœ¨è¼‰å…¥ä¾†è³“åˆ—è¡¨...</div>`;
                document.getElementById('guestListAdminSection').classList.remove('hidden');

                const { data: guests, error } = await supabaseClient.from('guests').select('*').order('created_at', { ascending: false });
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-8">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
                    return;
                }
                if (guests.length === 0) {
                     container.innerHTML = '<div class="text-center text-blue-300 py-8">ç›®å‰æ²’æœ‰ä»»ä½•ä¾†è³“è³‡æ–™</div>';
                     return;
                }
                container.innerHTML = guests.map(guest => `
                    <div class="bg-white/5 rounded-lg p-4 mb-3">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex-1 text-left mb-3 sm:mb-0">
                                <h3 class="text-white font-semibold">${guest.name} <span class="text-sm font-normal text-gray-300">- ${guest.profession}</span></h3>
                                <p class="text-blue-200 text-sm">ä»‹ç´¹äººï¼š${guest.referrer}</p>
                                <p class="text-yellow-300 text-sm">åŠ å…¥æ„é¡˜ï¼š${guest.interest_level}</p>
                            </div>
                            <div class="flex flex-wrap gap-2 justify-start sm:justify-end">
                                <button type="button" onclick="editGuest(${guest.id}, '${escapeHTML(guest.name)}', '${escapeHTML(guest.profession)}', '${escapeHTML(guest.referrer)}', '${guest.interest_level}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm">ä¿®æ”¹</button>
                                <button type="button" onclick="promoteGuestToMember(${guest.id}, '${escapeHTML(guest.name)}')" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">è½‰ç‚ºå°ç”Ÿ</button>
                                <button type="button" onclick="deleteGuest(${guest.id}, '${escapeHTML(guest.name)}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm">åˆªé™¤</button>
                            </div>
                        </div>
                    </div>`).join('');
            }
            
            async function showPublicGuestList() {
                const container = document.getElementById('publicGuestListContainer');
                container.innerHTML = `<div class="text-white text-center p-4">æ­£åœ¨è¼‰å…¥æœ€æ–°ä¾†è³“...</div>`;
                const { data: guests, error } = await supabaseClient.from('guests').select('*').order('created_at', { ascending: false }).limit(10);
                
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-4">ç„¡æ³•è¼‰å…¥ä¾†è³“åˆ—è¡¨</div>`;
                    return;
                }
                if (guests.length === 0) {
                    container.innerHTML = `<div class="text-center text-blue-300 py-4">ç›®å‰é‚„æ²’æœ‰ä¾†è³“ç™»è¨˜</div>`;
                    return;
                }

                container.innerHTML = guests.map(guest => {
                    const interestColorClass = guest.interest_level === 'é«˜' ? 'bg-red-500/50 text-red-200' : 
                                               guest.interest_level === 'ä¸­' ? 'bg-yellow-500/50 text-yellow-200' : 
                                               'bg-green-500/50 text-green-200';
                    return `
                    <div class="bg-white/5 rounded-lg p-3 flex items-center justify-between">
                        <div>
                            <p class="text-white font-semibold">${guest.name} <span class="text-sm font-normal text-gray-300">- ${guest.profession}</span></p>
                            <p class="text-xs text-blue-200">ä»‹ç´¹äºº: ${guest.referrer}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${interestColorClass}">
                                æ„é¡˜ ${guest.interest_level}
                            </span>
                        </div>
                    </div>`;
                }).join('');
            }

            async function addGuest() {
                const name = document.getElementById('guestName').value.trim();
                const profession = document.getElementById('guestProfession').value.trim();
                const referrer = document.getElementById('guestReferrer').value.trim();
                const interest_level = document.getElementById('guestInterest').value;

                if (!name || !profession || !referrer) {
                    alert('å§“åã€å°ˆæ¥­åˆ¥å’Œä»‹ç´¹äººç‚ºå¿…å¡«é …ç›®ã€‚');
                    return;
                }

                const { error } = await supabaseClient.from('guests').insert({ name, profession, referrer, interest_level });
                
                if (error) {
                    alert('ç™»è¨˜å¤±æ•—ï¼š' + error.message);
                } else {
                    alert('æ„Ÿè¬æ‚¨çš„ç™»è¨˜ï¼');
                    document.getElementById('guestName').value = '';
                    document.getElementById('guestProfession').value = '';
                    document.getElementById('guestReferrer').value = '';
                    showPublicGuestList();
                }
            }
            
            async function editGuest(guestId, currentName, currentProfession, currentReferrer, currentInterest) {
                const newName = prompt("è«‹è¼¸å…¥æ–°çš„ä¾†è³“å§“åï¼š", currentName);
                if (newName === null || newName.trim() === '') return;

                const newProfession = prompt("è«‹è¼¸å…¥æ–°çš„å°ˆæ¥­åˆ¥ï¼š", currentProfession);
                if (newProfession === null) return;

                const newReferrer = prompt("è«‹è¼¸å…¥æ–°çš„ä»‹ç´¹äººï¼š", currentReferrer);
                if (newReferrer === null) return;

                let newInterest = prompt("è«‹è¼¸å…¥æ–°çš„åŠ å…¥æ„é¡˜åº¦ (é«˜, ä¸­, ä½)ï¼š", currentInterest);
                if (newInterest === null) return;
                
                newInterest = newInterest.trim();
                if (!['é«˜', 'ä¸­', 'ä½'].includes(newInterest)) {
                     alert('æ„é¡˜åº¦æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥ é«˜ã€ä¸­ æˆ– ä½ã€‚');
                     return;
                }

                const { error } = await supabaseClient
                    .from('guests')
                    .update({ name: newName.trim(), profession: newProfession.trim(), referrer: newReferrer.trim(), interest_level: newInterest })
                    .eq('id', guestId);

                if (error) {
                    alert('æ›´æ–°ä¾†è³“è³‡æ–™å¤±æ•—ï¼š' + error.message);
                } else {
                    alert('ä¾†è³“è³‡æ–™å·²æˆåŠŸæ›´æ–°ï¼');
                    showGuestList();
                    showPublicGuestList();
                }
            }
            window.editGuest = editGuest;
            
            async function deleteGuest(guestId, guestName) {
                if (confirm(`ç¢ºå®šè¦åˆªé™¤ä¾†è³“ ${guestName} çš„è³‡æ–™å—ï¼Ÿ`)) {
                     const { error } = await supabaseClient.from('guests').delete().eq('id', guestId);
                    if (error) {
                        alert('åˆªé™¤å¤±æ•—ï¼š' + error.message);
                    } else {
                        alert('åˆªé™¤æˆåŠŸï¼');
                        showPublicGuestList();
                        if (!document.getElementById('adminPanelScreen').classList.contains('hidden')) {
                            showGuestList();
                        }
                    }
                }
            }
            window.deleteGuest = deleteGuest;

            async function promoteGuestToMember(guestId, guestName) {
                if (!confirm(`ç¢ºå®šè¦å°‡ä¾†è³“ ${guestName} è½‰ç‚ºæ­£å¼å°ç”Ÿå—ï¼Ÿ\næ­¤å‹•ä½œæœƒå°‡å…¶å¾ä¾†è³“åå–®ä¸­ç§»é™¤ã€‚`)) return;

                const { data: guest, error: fetchError } = await supabaseClient.from('guests').select('*').eq('id', guestId).single();
                if (fetchError || !guest) return alert('æ‰¾ä¸åˆ°ä¾†è³“è³‡æ–™ï¼Œç„¡æ³•è½‰æ›ã€‚');
                
                const { data: existingMember } = await supabaseClient.from('members').select('id').eq('name', guest.name).single();
                if (existingMember) return alert(`è½‰æ›å¤±æ•—ï¼šåç‚º ${guest.name} çš„å°ç”Ÿå·²ç¶“å­˜åœ¨ã€‚`);

                const { error: insertError } = await supabaseClient.from('members').insert({
                    name: guest.name,
                    industry: guest.profession,
                    tasks: getInitialTasksForDB()
                });
                if (insertError) return alert(`æ–°å¢è‡³å°ç”Ÿåå–®æ™‚å¤±æ•—ï¼š${insertError.message}`);

                const { error: deleteError } = await supabaseClient.from('guests').delete().eq('id', guestId);
                if (deleteError) return alert(`å·²æˆåŠŸæ–°å¢ç‚ºå°ç”Ÿï¼Œä½†å¾ä¾†è³“åå–®åˆªé™¤æ™‚å¤±æ•—ï¼š${deleteError.message}\nè«‹æ‰‹å‹•åˆªé™¤ã€‚`);
                
                alert(`å·²æˆåŠŸå°‡ ${guestName} è½‰ç‚ºå°ç”Ÿï¼`);
                showGuestList(); 
            }
            window.promoteGuestToMember = promoteGuestToMember;
            // â˜…â˜…â˜… ä¾†è³“åå–®åŠŸèƒ½ (JS) END â˜…â˜…â˜…

            // â˜…â˜…â˜… è¡Œäº‹æ›†åŠŸèƒ½ (JS) START â˜…â˜…â˜…
            async function showPublicCalendar() {
                const container = document.getElementById('publicCalendarList');
                container.innerHTML = `<div class="text-white text-center p-4">æ­£åœ¨è¼‰å…¥æ´»å‹•...</div>`;
                const { data: events, error } = await supabaseClient.from('calendar_events').select('*').order('event_date', { ascending: true });
                
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-4">ç„¡æ³•è¼‰å…¥æ´»å‹•</div>`;
                    return;
                }
                if (events.length === 0) {
                    container.innerHTML = `<div class="text-center text-blue-300 py-4">ç›®å‰æ²’æœ‰ä»»ä½•æ´»å‹•</div>`;
                    return;
                }

                container.innerHTML = events.map(event => `
                    <div class="bg-white/5 rounded-lg p-3">
                        <p class="text-yellow-300 font-semibold">${event.event_date}</p>
                        <p class="text-white font-semibold mt-1">${event.title}</p>
                        ${event.description ? `<p class="text-xs text-blue-200 mt-1">${event.description}</p>`: ''}
                    </div>`).join('');
            }
            
            async function showCalendarManagement() {
                hideAdminSections();
                const container = document.getElementById('adminCalendarList');
                container.innerHTML = `<div class="text-white text-center p-8">æ­£åœ¨è¼‰å…¥æ´»å‹•åˆ—è¡¨...</div>`;
                document.getElementById('calendarManagementSection').classList.remove('hidden');

                const { data: events, error } = await supabaseClient.from('calendar_events').select('*').order('event_date', { ascending: false });
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-8">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
                    return;
                }
                if (events.length === 0) {
                     container.innerHTML = '<div class="text-center text-blue-300 py-8">ç›®å‰æ²’æœ‰ä»»ä½•æ´»å‹•</div>';
                     return;
                }
                container.innerHTML = events.map(event => `
                    <div class="bg-white/5 rounded-lg p-4 mb-3">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                            <div class="flex-1 text-left mb-3 sm:mb-0">
                                <h3 class="text-white font-semibold">${event.event_date} - ${event.title}</h3>
                                <p class="text-blue-200 text-sm">${event.description || 'ç„¡èªªæ˜'}</p>
                            </div>
                            <div class="flex flex-wrap gap-2 justify-start sm:justify-end">
                                <button type="button" onclick="editCalendarEvent(${event.id}, '${escapeHTML(event.title)}', '${event.event_date}', '${escapeHTML(event.description)}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm">ä¿®æ”¹</button>
                                <button type="button" onclick="deleteCalendarEvent(${event.id}, '${escapeHTML(event.title)}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm">åˆªé™¤</button>
                            </div>
                        </div>
                    </div>`).join('');
            }

            async function addCalendarEvent() {
                const event_date = document.getElementById('eventDate').value;
                const title = document.getElementById('eventTitle').value.trim();
                const description = document.getElementById('eventDescription').value.trim();

                if (!event_date || !title) {
                    alert('æ—¥æœŸå’Œæ¨™é¡Œç‚ºå¿…å¡«é …ç›®ã€‚');
                    return;
                }

                const { error } = await supabaseClient.from('calendar_events').insert({ event_date, title, description });
                
                if (error) {
                    alert('æ–°å¢å¤±æ•—ï¼š' + error.message);
                } else {
                    alert('æ´»å‹•å·²æˆåŠŸæ–°å¢ï¼');
                    document.getElementById('eventDate').value = '';
                    document.getElementById('eventTitle').value = '';
                    document.getElementById('eventDescription').value = '';
                    showCalendarManagement();
                    showPublicCalendar();
                }
            }
            
            async function editCalendarEvent(eventId, currentTitle, currentDate, currentDescription) {
                const newDate = prompt("è«‹è¼¸å…¥æ–°çš„æ´»å‹•æ—¥æœŸï¼š", currentDate);
                if (newDate === null || newDate.trim() === '') return;

                const newTitle = prompt("è«‹è¼¸å…¥æ–°çš„æ´»å‹•æ¨™é¡Œï¼š", currentTitle);
                if (newTitle === null || newTitle.trim() === '') return;
                
                const newDescription = prompt("è«‹è¼¸å…¥æ–°çš„æ´»å‹•èªªæ˜ï¼š", currentDescription);
                if (newDescription === null) return;

                const { error } = await supabaseClient
                    .from('calendar_events')
                    .update({ event_date: newDate, title: newTitle.trim(), description: newDescription.trim() })
                    .eq('id', eventId);

                if (error) {
                    alert('æ›´æ–°æ´»å‹•å¤±æ•—ï¼š' + error.message);
                } else {
                    alert('æ´»å‹•è³‡æ–™å·²æˆåŠŸæ›´æ–°ï¼');
                    showCalendarManagement();
                    showPublicCalendar();
                }
            }
            window.editCalendarEvent = editCalendarEvent;

            async function deleteCalendarEvent(eventId, eventTitle) {
                if (confirm(`ç¢ºå®šè¦åˆªé™¤æ´»å‹• "${eventTitle}" å—ï¼Ÿ`)) {
                     const { error } = await supabaseClient.from('calendar_events').delete().eq('id', eventId);
                    if (error) {
                        alert('åˆªé™¤å¤±æ•—ï¼š' + error.message);
                    } else {
                        alert('åˆªé™¤æˆåŠŸï¼');
                        showCalendarManagement();
                        showPublicCalendar();
                    }
                }
            }
            window.deleteCalendarEvent = deleteCalendarEvent;
            // â˜…â˜…â˜… è¡Œäº‹æ›†åŠŸèƒ½ (JS) END â˜…â˜…â˜…

            const updateFontSize = (change) => {
                const rootElement = document.documentElement;
                const currentSize = parseFloat(window.getComputedStyle(rootElement).fontSize);
                let newSize = currentSize + change;
                if (newSize < 12) newSize = 12;
                if (newSize > 24) newSize = 24;
                rootElement.style.fontSize = newSize + 'px';
            };
            
            document.addEventListener('DOMContentLoaded', function() {
                // ... (existing event listeners)
                document.getElementById('loginButton')?.addEventListener('click', handleLogin);
                document.getElementById('memberName')?.addEventListener('keypress', e => { if (e.key === 'Enter') handleLogin(); });
                document.getElementById('memberPassword')?.addEventListener('keypress', e => { if (e.key === 'Enter') handleLogin(); });
                document.getElementById('showAdminBtn')?.addEventListener('click', showAdminLogin);
                document.getElementById('hideAdminBtn')?.addEventListener('click', hideAdminLogin);
                document.getElementById('adminLoginBtn')?.addEventListener('click', handleAdminLogin);
                document.getElementById('adminPassword')?.addEventListener('keypress', e => { if (e.key === 'Enter') handleAdminLogin(); });
                document.getElementById('showAddMemberBtn')?.addEventListener('click', showAddMember);
                document.getElementById('createMemberBtn')?.addEventListener('click', createMember);
                document.getElementById('showMemberListBtn')?.addEventListener('click', showMemberList);
                document.getElementById('showMemberMgmtBtn')?.addEventListener('click', showMemberManagement);
                document.getElementById('showPasswordSettingsBtn')?.addEventListener('click', showPasswordSettings);
                document.getElementById('changePasswordBtn')?.addEventListener('click', changeAdminPassword);
                document.getElementById('clearAllDataBtn')?.addEventListener('click', clearAllData);
                document.getElementById('hideAdminPanelBtn')?.addEventListener('click', hideAdminPanel);
                document.querySelectorAll('.hide-section-btn').forEach(btn => btn.addEventListener('click', hideAdminSections));
                document.getElementById('logoutBtn')?.addEventListener('click', logout);
                document.getElementById('closeCelebrationBtn')?.addEventListener('click', closeCelebration);
                document.getElementById('closeMemberTaskBtn')?.addEventListener('click', closeMemberTaskModal);
                document.querySelector('[data-category="all"]')?.addEventListener('click', () => filterTasks('all'));
                document.getElementById('increaseFont')?.addEventListener('click', () => updateFontSize(1));
                document.getElementById('decreaseFont')?.addEventListener('click', () => updateFontSize(-1));
                document.getElementById('resetFont')?.addEventListener('click', () => { document.documentElement.style.fontSize = ''; });
                document.getElementById('toggleGuestSectionBtn')?.addEventListener('click', () => {
                    document.getElementById('guestFormSection').classList.toggle('hidden');
                });
                document.getElementById('submitGuestBtn')?.addEventListener('click', addGuest);
                document.getElementById('showGuestListBtn')?.addEventListener('click', showGuestList);
                document.getElementById('showCalendarMgmtBtn')?.addEventListener('click', showCalendarManagement);
                document.getElementById('addEventBtn')?.addEventListener('click', addCalendarEvent);
                
                // New event listener for collapsible guest list
                const guestListToggle = document.getElementById('togglePublicGuestList');
                const guestListContainer = document.getElementById('publicGuestListContainer');
                const guestListChevron = document.getElementById('guestListChevron');
                guestListToggle.addEventListener('click', () => {
                    guestListContainer.classList.toggle('hidden');
                    guestListChevron.classList.toggle('rotate-180');
                });

                const requiredTotal = tasksTemplate.filter(t => t.isRequired).length;
                document.getElementById('totalTasks').textContent = requiredTotal - 1;
                
                checkSession();
                showLoginRanking();
                showPublicGuestList(); 
                showPublicCalendar();
            });

        })();
    </script>
</body>
</html>
by æŠ•å˜‰é›²å½°å€åŸŸ é›²è²´åˆ†æœƒ é«˜å±å€æ°´é›»å·¥ç¨‹ å³å¿—ç’˜     V161è¡Œäº‹æ›†ç‰ˆæœ¬

